<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Administración</title>
</head>
<body>
    <h2>Panel de Administración</h2>
    <p>Bienvenido, {{ username }} ({{ role }})</p>

    <form method="GET" action="{{ url_for('admin') }}">
        <label for="filtro_usuario">Filtrar por usuario:</label>
        <select name="filtro_usuario" id="filtro_usuario">
            <option value="">Todos</option>
            {% for usuario in usuarios %}
                <option value="{{ usuario.id }}" {% if filtro_usuario and filtro_usuario|int == usuario.id %}selected{% endif %}>
                    {{ usuario.username }}
                </option>
            {% endfor %}
        </select>

        <label for="fecha_inicio">Desde:</label>
        <input type="date" name="fecha_inicio" value="{{ fecha_inicio if fecha_inicio }}">

        <label for="fecha_fin">Hasta:</label>
        <input type="date" name="fecha_fin" value="{{ fecha_fin if fecha_fin }}">

        <button type="submit">Filtrar</button>
    </form>

    <br>

    <form action="{{ url_for('exportar_excel') }}" method="GET">
        <input type="hidden" name="filtro_usuario" value="{{ filtro_usuario }}">
        <input type="hidden" name="fecha_inicio" value="{{ fecha_inicio }}">
        <input type="hidden" name="fecha_fin" value="{{ fecha_fin }}">
        <button type="submit">Exportar a Excel</button>
    </form>

    <br>

    <table border="1">
        <thead>
            <tr>
                <th>Usuario</th>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Contrato</th>
                <th>Service Order</th>
                <th>Centro de Costo</th>
                <th>Tipo de Servicio</th>
                <th>Línea</th>
                <th>Entrada</th>
                <th>Salida</th>
                <th>Almuerzo</th>
                <th>Horas Trabajo</th>
                <th>Horas Viaje Ida</th>
                <th>Horas Viaje Vuelta</th>
                <th>KM Ida</th>
                <th>KM Vuelta</th>
                <th>Total Horas</th>
                <th>Comentarios</th>
            </tr>
        </thead>
        <tbody>
            {% for registro in registros %}
                <tr>
                    <td>{{ registro.user.username if registro.user else '' }}</td>
                    <td>{{ registro.fecha }}</td>
                    <td>{{ registro.cliente }}</td>
                    <td>{{ 'Sí' if registro.contrato else 'No' }}</td>
                    <td>{{ registro.service_order }}</td>
                    <td>{{ registro.centro_costo }}</td>
                    <td>{{ registro.tipo_servicio }}</td>
                    <td>{{ registro.linea }}</td>
                    <td>{{ registro.entrada }}</td>
                    <td>{{ registro.salida }}</td>
                    <td>{{ registro.almuerzo }}</td>
                    <td>{{ registro.horas }}</td>
                    <td>{{ registro.viaje_ida }}</td>
                    <td>{{ registro.viaje_vuelta }}</td>
                    <td>{{ registro.km_ida }}</td>
                    <td>{{ registro.km_vuelta }}</td>
                    <td>{{ (registro.horas or 0) + (registro.viaje_ida or 0) + (registro.viaje_vuelta or 0) }}</td>
                    <td>{{ registro.comentarios }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
